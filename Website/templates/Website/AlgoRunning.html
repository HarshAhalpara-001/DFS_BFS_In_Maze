<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Maze Solver - DFS</title>
    <style>
      /* Dark theme background */
      body {
        background-color: #121212;
        color: #e0e0e0;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
      }

      h1,
      h2 {
        color: #ffffff;
      }

      /* Styling for the matrix table */
      table {
        border-collapse: collapse;
        margin: 10px 0;
      }

      td {
        width: 30px;
        height: 30px;
        text-align: center;
        border: 1px solid #444;
      }

      /* Styling for blocks (walls) */
      .block {
        background-color: #333;
      }

      /* Styling for paths (steps) */
      .path {
        background-color: #007bff;
      }

      /* Styling for buttons */
      button {
        background-color: #444;
        color: #e0e0e0;
        border: none;
        padding: 10px 20px;
        margin: 10px 5px;
        cursor: pointer;
        border-radius: 5px;
      }

      button:hover {
        background-color: #555;
      }

      /* Styling for current step indicator */
      #step-number {
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>Maze Solver Visualization</h1>

    <!-- Display the merged matrix -->
    <h2>Merged Maze and Steps</h2>
    <div id="merged-matrix"></div>

    <!-- Display the path status -->
    <h2>Path Found: <span id="path-status"></span></h2>

    <!-- Display the step navigation -->
    <h2>Steps</h2>
    <button id="prev-step">Previous Step</button>
    <button id="next-step">Next Step</button>
    <button id="start-auto">Start</button>
    <button id="stop-auto">Stop</button>
    <label for="time-input">Time Interval (seconds):</label>
    <input type="number" id="time-input" value="0.5" step="0.1" min="0.1" />
    <p>Current Step: <span id="step-number">0</span></p>

    <script>
      // Parse the JSON data passed from Django
      const data = JSON.parse("{{ data|escapejs }}");
      const matrix = data.matrix;
      const steps = data.steps;
      const pathFound = data.path_found;
      let currentStep = 0;
      let autoStepInterval = null; // Variable to store the interval ID

      // Function to render the merged matrix with steps
      function renderMergedMatrix(stepIndex) {
        const container = document.getElementById("merged-matrix");
        container.innerHTML = ""; // Clear previous content

        const table = document.createElement("table");

        // Loop through the rows of the matrix
        matrix.forEach((row, rowIndex) => {
          const tr = document.createElement("tr");
          row.forEach((cell, colIndex) => {
            const td = document.createElement("td");

            // Check for block (1) and apply block class
            if (cell === 1) {
              td.classList.add("block"); // Wall
            }

            // Check if this cell is part of the current step's path
            if (
              stepIndex < steps.length &&
              steps[stepIndex][rowIndex][colIndex]
            ) {
              td.classList.add("path"); // Highlight path
            }

            tr.appendChild(td);
          });
          table.appendChild(tr);
        });

        container.appendChild(table);
      }

      // Render the merged matrix for the initial step
      renderMergedMatrix(currentStep);

      // Update the path status
      document.getElementById("path-status").textContent = pathFound
        ? "Yes"
        : "No";

      // Event listeners for the navigation buttons
      document.getElementById("next-step").addEventListener("click", () => {
        if (currentStep < steps.length - 1) {
          currentStep++;
          renderMergedMatrix(currentStep);
          document.getElementById("step-number").textContent = currentStep;
        }
      });

      document.getElementById("prev-step").addEventListener("click", () => {
        if (currentStep > 0) {
          currentStep--;
          renderMergedMatrix(currentStep);
          document.getElementById("step-number").textContent = currentStep;
        }
      });

      // Start auto-navigation
      document.getElementById("start-auto").addEventListener("click", () => {
        const timeInterval =
          parseFloat(document.getElementById("time-input").value) * 1000; // Convert to milliseconds
        if (!autoStepInterval) {
          autoStepInterval = setInterval(() => {
            if (currentStep < steps.length - 1) {
              currentStep++;
              renderMergedMatrix(currentStep);
              document.getElementById("step-number").textContent = currentStep;
            } else {
              clearInterval(autoStepInterval); // Stop if at the last step
            }
          }, timeInterval);
        }
      });

      // Stop auto-navigation
      document.getElementById("stop-auto").addEventListener("click", () => {
        clearInterval(autoStepInterval);
        autoStepInterval = null; // Reset the interval ID
      });
    </script>
  </body>
</html>
